{
  "version": "https://jsonfeed.org/version/1",
  "title": "Locke&#39;s engineering journal",
  "home_page_url": "https://locke0.github.io/blog",
  "feed_url": "https://locke0.github.io/feed/feed.json",
  "description": "projects, ideas, solutions",
  "author": {
    "name": "Yangyue (Locke) Wang",
    "url": ""
  },
  "items": [{
      "id": "https://locke0.github.io/blog/posts/TheKaggleSantaCompetition/",
      "url": "https://locke0.github.io/blog/posts/TheKaggleSantaCompetition/",
      "title": "Solve the Kaggle Polytope Puzzle",
      "content_html": "<p>Ok! Let‚Äôs try to solve the $25,000 Kaggle Competition: Santa 2023 ‚Äî The Polytope Permutation Puzzle today‚Ä¶as a beginner.</p>\n<p>Some context, I have little experience with Kaggle competitions. In fact, this will be the 2nd Kaggle competition I‚Äôm participating with the first one being the infamous Titan Challenge. So I‚Äôm literally a noob ü§∑ (Sorry about the click bait. Oh well, I didn‚Äôt win). However, I have been really wanting to get into Kaggle more and get better at deep learning. This is why I‚Äôm writing this blog with the intention of showing how I approached a problem in a new or unfamiliar knowledge domain in term of navigating, researching, learning and problem solving.</p>\n<p>Alright, let‚Äôs dive in üò§!</p>\n<h2 id=\"1-overview\">1 Overview</h2>\n<h3 id=\"1.1-problem\">1.1 Problem</h3>\n<p>First, you have to do some research and understand the problem. Starting with the Overview page, here is what I gathered:</p>\n<ul>\n<li>\n<p><strong>The Problem</strong>: solve <strong>cube-like</strong> puzzles in the <strong><strong><strong><strong><strong><strong>fewest</strong></strong></strong></strong></strong></strong> moves</p>\n<ul>\n<li>Permutation puzzle: comprises\n<ul>\n<li>solution state</li>\n<li>initial state</li>\n<li>colors whose arrangements make up states</li>\n<li>a set of allowed moves</li>\n<li>The resulting state may differ up to the puzzle‚Äôs <code>num_wildcards</code></li>\n<li>The <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>overall score</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong> is the total number of moves in all of its puzzle solutions (fewest moves)</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Submission file format:</strong></p>\n<ul>\n<li>$\\textrm{For each id, the moves} \\in \\textrm{allowed moves}$</li>\n</ul>\n<pre class=\"language-python\"><code class=\"language-python\"><span class=\"token builtin\">id</span><span class=\"token punctuation\">,</span>moves<br><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>r1<span class=\"token punctuation\">.</span><span class=\"token operator\">-</span>f1<br><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>f1<span class=\"token punctuation\">.</span>d0<span class=\"token punctuation\">.</span><span class=\"token operator\">-</span>r0<span class=\"token punctuation\">.</span><span class=\"token operator\">-</span>f1<span class=\"token punctuation\">.</span><span class=\"token operator\">-</span>d0<span class=\"token punctuation\">.</span><span class=\"token operator\">-</span>f1<span class=\"token punctuation\">.</span>d0<span class=\"token punctuation\">.</span><span class=\"token operator\">-</span>r0<span class=\"token punctuation\">.</span>f0<br><span class=\"token number\">2</span><span class=\"token punctuation\">,</span>f1<span class=\"token punctuation\">.</span>d0<span class=\"token punctuation\">.</span><span class=\"token operator\">-</span>d1<span class=\"token punctuation\">.</span>r0<span class=\"token punctuation\">.</span><span class=\"token operator\">-</span>d1<span class=\"token punctuation\">.</span><span class=\"token operator\">-</span>f0<span class=\"token punctuation\">.</span>f1<span class=\"token punctuation\">.</span><span class=\"token operator\">-</span>r0<span class=\"token punctuation\">.</span><span class=\"token operator\">-</span>f0</code></pre>\n</li>\n</ul>\n<p>So basically, you have to figure out the transitions between 2 states and each state is a matrix of numbers. Ok, let‚Äôs briefly take a look at the dataset.</p>\n<h3 id=\"1.2-dataset\">1.2 Dataset</h3>\n<p>First, I looked at the</p>\n<ul>\n<li>\n<p><strong>puzzle_info.csv:</strong></p>\n<ul>\n<li><code>puzzle_type</code></li>\n<li><code>allowed_move</code> - Each move represents a permutation given in array form</li>\n</ul>\n<p>Basically, this file stores what moves are allowed for each puzzle type.</p>\n</li>\n<li>\n<p><strong><strong><strong><strong><strong><strong><strong><strong>puzzle.csv</strong></strong></strong></strong></strong></strong></strong></strong></p>\n<ul>\n<li><code>id</code></li>\n<li><code>puzzle_type</code></li>\n<li><code>solution_state</code> - ‚Äúcolors‚Äù separated by <code>;</code> (e.g. a 2 by 2 by 2 cube would have  $4*6 = 24$ elements)</li>\n<li><code>initial_state</code> - an arrangement of colors describing the initial statecd cd</li>\n<li><code>num_wildcards</code> - so, nums of difference allowed in the final state (it doesn‚Äôt have to be exactly the required final state)</li>\n</ul>\n</li>\n<li>\n<p><strong>sample_submission.csv</strong></p>\n<ul>\n<li><code>id</code></li>\n<li><code>moves</code></li>\n</ul>\n<p>This just shows the moves from allowed_moves associated with each puzzle type</p>\n</li>\n</ul>\n<h3 id=\"1.3-first-impression-insights\">1.3 First Impression Insights</h3>\n<p>Ok! Now let‚Äôs digest all that info and redefine our problem/objective to:</p>\n<blockquote>\n<p><em>Minimize the number of transitions taken to get from state A to state B</em>.</p>\n</blockquote>\n<p>When the problem is presented this way, we can start breaking down the problem into smaller components and steps</p>\n<p><strong>First</strong>, we should probably find the proper data structures to store <em>states</em> and <em>transitions</em> since the given array or string forms might <em>not</em> be the most convenient for modeling the $state \\rightarrow transition \\rightarrow state$ process/relation. From what I remember from my experience in robotics, maybe states can be represented as matrices instead of the given array form.</p>\n<p><strong>However</strong>, I am still not sure about how to implement the specifics. So, let‚Äôs do more research and see what discussions and solutions others have shared online. I started looking at the Code, Discussion page of the competition, YouTube, and Google.</p>\n<h2 id=\"2-%E2%80%9Cliterature-review%E2%80%9D\">2 ‚ÄúLiterature Review‚Äù</h2>\n<h3 id=\"2.1-a-basic-tutorial-%E2%80%94-getting-started-with-santa-2023.\"><strong>2.1 A Basic Tutorial  ‚Äî <a href=\"https://www.kaggle.com/code/ryanholbrook/getting-started-with-santa-2023\">Getting Started with Santa 2023</a>.</strong></h3>\n<p>This tutorial covers the basics. I‚Äôm glad I took a look at the Code page and this would save me some time. Specifically, it shows:</p>\n<ul>\n<li>\n<p>How to <em>import</em> and <em>parse</em> the <code>puzzle_info</code> and <code>puzzles</code> into proper formats from corresponding files using pandas.</p>\n</li>\n<li>\n<p>How to <em>represent</em> the puzzle states with <code>numpy.array</code></p>\n</li>\n<li>\n<p>How to <em>represent</em> the moves with <code>Permutation</code> from the <code>sympy.combinatorics</code> ‚Äî I had never used it before. If you want to learn more, here is its <a href=\"https://docs.sympy.org/latest/modules/combinatorics/permutations.html\">documentation page</a></p>\n</li>\n<li>\n<p>üí° <strong>Key Takeaways</strong></p>\n<blockquote>\n<ol>\n<li>Data Structure ‚Äî <code>Permutation</code></li>\n</ol>\n<ul>\n<li>[DEFINITION] ‚Äî The sympy permutation uses the <strong>indices</strong> of the elements in the original ordering of the elements in the array instead of the elements themselves.</li>\n<li>[COMPOSITION] ‚Äî Permutation takes a 2-line form: <code>[0 1 2 ... n-1] [p(0) p(1) p(2) ... p(n-1)]</code>, where <code>p(i) = i^p</code>. The composite of 2 permutations <code>p*q</code> is the same as <code>i^(p*q) = i^p^q</code> (with Python‚Äôs precedence rule)</li>\n<li>[DISJOINT CYCLE NOTATION] <strong>‚Äî</strong> [1, 3, 2, 0] represented as (0, 1, 3)(2) meaning 0 ‚Üí 1 ‚Üí 3 and 2 stays where it is.</li>\n</ul>\n<p>Examples of how permutation can be used in our case:</p>\n<pre class=\"language-python\"><code class=\"language-python\">solution_state <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'R'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'G'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'B'</span><span class=\"token punctuation\">]</span><br>initial_state <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'B'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'G'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'R'</span><span class=\"token punctuation\">]</span><br>moves <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token string\">'r'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'s'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><br><span class=\"token punctuation\">}</span><br>move_r <span class=\"token operator\">=</span> moves<span class=\"token punctuation\">[</span><span class=\"token string\">'r'</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># 0->1, 1->2, 2->0</span><br>move_rp <span class=\"token operator\">=</span> Permutation<span class=\"token punctuation\">(</span>move_r<span class=\"token punctuation\">)</span><br>initial_state_np <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>asarray<span class=\"token punctuation\">(</span>initial_state<span class=\"token punctuation\">)</span><br><br><span class=\"token comment\"># after move_r</span><br>resulting_state <span class=\"token operator\">=</span> move_rp<span class=\"token punctuation\">(</span>initial_state_np<span class=\"token punctuation\">)</span><br><br><span class=\"token comment\"># ways to inverse moves</span><br><span class=\"token comment\"># array form, because the elements in r is target location</span><br><span class=\"token comment\"># the orignal locations of the state are labeled as</span><br><span class=\"token comment\"># 0, 1, 2, ... by default</span><br>move_r_inv <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>argsort<span class=\"token punctuation\">(</span>move_r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>tolist<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><br><span class=\"token comment\"># Permutation form, more clear to me personally</span><br>move_rp_inv <span class=\"token operator\">=</span> move_rp <span class=\"token operator\">**</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span></code></pre>\n</blockquote>\n<blockquote>\n<ol start=\"2\">\n<li>Array vs Permutation ‚Äî The permutation approach is NOT ONLY cleaner and more intuitive for representing the transitions and states, it also seems to be twice faster according to my profiling:</li>\n</ol>\n<pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">array_func</span><span class=\"token punctuation\">(</span>initial_state<span class=\"token punctuation\">,</span> moves<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span><br>  count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><br>  r <span class=\"token operator\">=</span> moves<span class=\"token punctuation\">[</span><span class=\"token string\">'r'</span><span class=\"token punctuation\">]</span><br>  s <span class=\"token operator\">=</span> moves<span class=\"token punctuation\">[</span><span class=\"token string\">'s'</span><span class=\"token punctuation\">]</span><br>  r_inv <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>argsort<span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>tolist<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><br><br>  <span class=\"token keyword\">while</span> count <span class=\"token operator\">&lt;</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">:</span><br>    state <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>asarray<span class=\"token punctuation\">(</span>initial_state<span class=\"token punctuation\">)</span><br>    state <span class=\"token operator\">=</span> state<span class=\"token punctuation\">[</span>s<span class=\"token punctuation\">]</span><br>    state <span class=\"token operator\">=</span> state<span class=\"token punctuation\">[</span>r_inv<span class=\"token punctuation\">]</span><br>    state <span class=\"token operator\">=</span> state<span class=\"token punctuation\">.</span>tolist<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><br>    count <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><br><br><span class=\"token keyword\">def</span> <span class=\"token function\">per_func</span><span class=\"token punctuation\">(</span>initial_state<span class=\"token punctuation\">,</span> moves<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span><br>  count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><br>  r <span class=\"token operator\">=</span> moves<span class=\"token punctuation\">[</span><span class=\"token string\">'r'</span><span class=\"token punctuation\">]</span><br>  s <span class=\"token operator\">=</span> moves<span class=\"token punctuation\">[</span><span class=\"token string\">'s'</span><span class=\"token punctuation\">]</span><br>  rp <span class=\"token operator\">=</span> Permutation<span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span><br>  sp <span class=\"token operator\">=</span> Permutation<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><br>  rp_inv <span class=\"token operator\">=</span> rp <span class=\"token operator\">**</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><br><br>  <span class=\"token keyword\">while</span> count <span class=\"token operator\">&lt;</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">:</span><br>    state <span class=\"token operator\">=</span> sp<span class=\"token punctuation\">(</span>initial_state<span class=\"token punctuation\">)</span><br>    state <span class=\"token operator\">=</span> rp_inv<span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">)</span><br>    count <span class=\"token operator\">+=</span> <span class=\"token number\">1</span></code></pre>\n<ul>\n<li>Outputs:</li>\n</ul>\n<pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">%</span>timeit array_func<span class=\"token punctuation\">(</span>initial_state<span class=\"token punctuation\">,</span> moves<span class=\"token punctuation\">)</span><br><span class=\"token comment\"># OUTPUT: 595 ms ¬± 99.1 ms per loop (mean ¬± std. dev. of 7 runs, 1 loop each)</span><br><br><span class=\"token operator\">%</span>timeit per_func<span class=\"token punctuation\">(</span>initial_state<span class=\"token punctuation\">,</span> moves<span class=\"token punctuation\">)</span><br><span class=\"token comment\"># OUTPUT: 306 ms ¬± 4.5 ms per loop (mean ¬± std. dev. of 7 runs, 1 loop each)</span></code></pre>\n</blockquote>\n<blockquote>\n<ol start=\"3\">\n<li>The 3 Puzzle Types ‚Äî Cube, Wreath, and Globe</li>\n</ol>\n<ul>\n<li>Cube n/n/n: A cube with n layers along each of the 3 face axes (<code>d0, d1</code> (up and down), <code>f0, f1</code> (front and back), <code>r0, r1</code> (right and left)</li>\n<li>Wreath x/y: 2 rings with x points in left and y in right</li>\n<li>Globe m/n: a sphere with <code>m</code> lateral cuts (latitude) and <code>n</code> radial cuts (longitude). This gives $(m+1)\\times(2n)$ positions on a grid:\n<ul>\n<li><code>m</code> lateral cuts ‚Üí <code>m+1</code> chunks</li>\n<li><code>n</code> radial cuts ‚Üí <code>2n</code> when unfolding 2 sides of the sphere ‚Äî think a world map</li>\n</ul>\n</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"2.2-others%E2%80%99-approaches\">2.2 Others‚Äô Approaches</h3>\n<p><strong>2.2.1 <a href=\"https://www.kaggle.com/competitions/santa-2023/discussion/466399#2605760\">All You Need is DISTANCE</a> ‚Äî An ML idea by Alexander Chervov</strong></p>\n<p>He basically says that we can train a model to predict the distance from any state to the solution state, then choose moves that decreases the distance. Distance function can be defined as the minimal number of moves to connect the two states.</p>\n<p>To predict the distance, he proposes that we use ML. First, we can create a training set of states and distances. Then, we can train a ML model to predict the distance and infer on any state.</p>\n<p>The training stage seems to be the biggest challenge of this approach ‚Äî from using random walk sampling to representing the states in an efficient way (üò±The number of states in <a href=\"https://www.therubikzone.com/number-of-combinations/\">5x5x5 cube similar to number of atoms in the universe</a>)</p>\n<p>Steps of his approach:</p>\n<ol>\n<li>\n<p>apply all moves to it get new states</p>\n</li>\n<li>\n<p>apply all moves to the states obtained on the previous step,</p>\n</li>\n<li>\n<p>SELECT only those states which were not found before (i.e. do not go back).</p>\n<pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># get unique elements of the newly obtained states (their hashes)</span><br>IX_unique <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>unique<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>concatenate<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>vec_hash<span class=\"token punctuation\">,</span> vec_hash_new <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> return_index<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><br>IX_unique <span class=\"token operator\">=</span> IX_unique<span class=\"token punctuation\">[</span>IX_unique <span class=\"token operator\">>=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>vec_hash<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>vec_hash<span class=\"token punctuation\">)</span></code></pre>\n</li>\n<li>\n<p>Hash those states with simple hash ‚Äî just matrix multiply by random int64 vector. (side note: float64 caused error with numpy in his experiment)</p>\n</li>\n<li>\n<p>States converted from string lists <code>['A','B'‚Ä¶]</code> to <code>numpy int8</code> vectors. All the states stored on one matrix (<code>array: np.int8</code>), with shape: state-length x number of states.</p>\n</li>\n</ol>\n<p>Here are a few <em>more</em> specific approaches I scraped from the comments of the same discussion:</p>\n<ul>\n<li><a href=\"https://www.kaggle.com/competitions/santa-2023/discussion/466399#2605019\">NN heuristic guiding A* search algorithm</a> by Vincent B. ‚Äî Doesn‚Äôt work well with larger puzzles</li>\n<li></li>\n</ul>\n<p>Here is the <a href=\"https://www.kaggle.com/competitions/santa-2023/discussion/466399#2605760\">discussion page</a> if you are interested in more details on the pain points.</p>\n<p><strong>2.2.2 <a href=\"https://www.kaggle.com/competitions/santa-2023/discussion/464415\">Matrix Reformation</a> ‚Äî Alexander Chervov</strong></p>\n<p>Alexander proposed another way of representations in addition to the Permutation way given by the organizer.</p>\n<p>The problem can be translated into:</p>\n<blockquote>\n<p>Find the shortest sequence of matrix multiplication</p>\n</blockquote>\n<ul>\n<li>[ ]  <a href=\"https://en.wikipedia.org/wiki/Permutation_matrix\">Permutation Matrix</a></li>\n</ul>\n<h2 id=\"3-solution-formation\">3 Solution Formation</h2>\n<ol>\n<li>Permutation Group Theory ‚Äî algebraic structures formed by permutations</li>\n<li>Cost Function ‚Äî that quantifies the &quot;distance&quot; or dissimilarity between two permutations</li>\n<li>Search Algorithms ‚Äî BFS, DFS, A* to explore the action space</li>\n<li>Heuristics ‚Äî for guiding searching and pruning branches</li>\n<li>Optimization Techniques ‚Äî parallelization, distributed computing, hardware acceleration</li>\n</ol>\n<p>Experimental</p>\n<ol>\n<li>Reinforcement learning with simulated annealing</li>\n<li></li>\n</ol>\n<h2 id=\"resources\">Resources</h2>\n<ul>\n<li><a href=\"https://www.kaggle.com/code/bprinz/visualizing-all-unique-solution-states\">great visualization here</a></li>\n<li><a href=\"https://www.kaggle.com/competitions/santa-2023/discussion/468370\">(A+B) + C ‚â† A + (B+C) in numpy discussion</a> + state with NN discussion : Don‚Äôt use float64</li>\n<li><a href=\"https://www.kaggle.com/competitions/santa-2023/discussion/468621\">alex algo</a></li>\n<li><a href=\"https://www.kaggle.com/code/alexandervc/santa23-cube222-locate-initial-states?scriptVersionId=159376616&amp;cellId=28\">alex notebook solution</a></li>\n<li><a href=\"https://www.kaggle.com/competitions/santa-2023/discussion/464415\">matrix reformation</a></li>\n<li><a href=\"https://www.kaggle.com/code/ryanholbrook/getting-started-with-santa-2023\">getting started</a></li>\n<li><a href=\"https://www.kaggle.com/code/alexandervc/santa23-states-distance-generate-save#Moves-%3EPermutation-matrices\">state distance generation</a></li>\n<li></li>\n</ul>\n",
      "date_published": "2024-01-19T19:00:00-05:00"
    }
  ]
}
